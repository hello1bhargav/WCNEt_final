<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ECIL - Internet Request Form</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .header {
      text-align: center;
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .header h1 {
      color: #333;
      margin: 0;
      font-size: 28px;
    }

    .header p {
      color: #666;
      margin: 5px 0 0 0;
    }

    .user-info {
      background: #e8f4fd;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid #2196F3;
    }

    .form-container {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: 0 auto;
    }

    .section-title {
      color: #333;
      border-bottom: 2px solid #2196F3;
      padding-bottom: 10px;
      margin-bottom: 25px;
      margin-top: 30px;
      font-size: 20px;
    }

    .section-title:first-child {
      margin-top: 0;
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      flex: 1;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e1e1e1;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #2196F3;
    }

    input[readonly] {
      background-color: #f8f9fa;
      color: #6c757d;
    }

    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
      margin-top: 4px;
    }

    .checkbox-group label {
      margin-bottom: 0;
      font-size: 14px;
      line-height: 1.4;
    }

    .submit-section {
      text-align: center;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid #eee;
    }

    .submit-btn {
      background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
      color: white;
      padding: 15px 40px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
    }

    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .message {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }

    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .logout-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #dc3545;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      font-size: 14px;
    }

    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
      }
      
      .form-container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="logout()">Logout</button>

  <div class="header">
    <h1>Internet Request Form</h1>
    <p>Electronics Corporation of India Limited</p>
  </div>

  <div class="user-info">
    <strong>Logged in as:</strong> <span id="currentUser"></span> (Normal User)
  </div>

  <div id="message" class="message"></div>

  <div class="form-container">
    <form id="requestForm">
      <h2 class="section-title">Particulars of the Applicant</h2>
      
      <div class="form-row">
        <div class="form-group">
          <label for="applicantName">Name of the Applicant</label>
          <input type="text" id="applicantName" name="applicantName" readonly>
        </div>
        <div class="form-group">
          <label for="divSecCode">Div-Sec-Code No.</label>
          <input type="text" id="divSecCode" name="divSecCode" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="designation">Designation</label>
          <input type="text" id="designation" name="designation" required>
        </div>
        <div class="form-group">
          <label for="contactPhone">Contact Phone No.</label>
          <input type="tel" id="contactPhone" name="contactPhone" required>
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" placeholder="xxxxx@ecil.co.in" required>
      </div>

      <h2 class="section-title">Particulars of the System</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="systemMake">System Make, Model etc.</label>
          <input type="text" id="systemMake" name="systemMake" required>
        </div>
        <div class="form-group">
          <label for="configuration">Configuration (CPU, RAM, HDD etc.)</label>
          <input type="text" id="configuration" name="configuration" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="osName">Operating System Name & Version</label>
          <input type="text" id="osName" name="osName" placeholder="e.g. Windows 10 64-bit" required>
        </div>
        <div class="form-group">
          <label for="licenseDetails">License Details of the OS</label>
          <input type="text" id="licenseDetails" name="licenseDetails" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="antivirusName">Anti-Virus Name & Version</label>
          <input type="text" id="antivirusName" name="antivirusName" required>
        </div>
        <div class="form-group">
          <label for="macAddress">MAC Address</label>
          <input type="text" id="macAddress" name="macAddress" required>
        </div>
      </div>

      <div class="form-group">
        <label for="ipAddress">IP Address (to be assigned by Admin)</label>
        <input type="text" id="ipAddress" name="ipAddress" placeholder="Leave blank - will be assigned" disabled>
      </div>

      <div class="checkbox-group">
        <input type="checkbox" id="agreement" name="agreement" required>
        <label for="agreement">
          I understand that the use of Internet is for official purposes only. I certify that only licensed software is being used on my machine. I would abide by the guidelines and rules regarding usage of Internet account as pronounced by the management from time to time.
        </label>
      </div>

      <div class="form-group">
        <label for="applicantSignature">Signature of the Applicant</label>
        <input type="text" id="applicantSignature" name="applicantSignature" readonly>
      </div>

      <div class="form-group">
        <label for="itChampion">Forward to IT Champion</label>
        <select id="itChampion" name="itChampion" required>
          <option value="">Select IT Champion</option>
          <option value="Alice Johnson">champion1</option>
        </select>
      </div>

      <div class="submit-section">
        <button type="submit" class="submit-btn" id="submitBtn">Submit Request</button>
      </div>
    </form>
  </div>

  <script>
    const API_BASE = '';
    
    // Check if user is logged in
    const userInfo = JSON.parse(sessionStorage.getItem('userInfo') || '{}');
    if (!userInfo.username || userInfo.role !== 'NormalUser') {
      window.location.href = 'index.html';
    }

    // Populate user info
    document.getElementById('currentUser').textContent = userInfo.username;
    document.getElementById('applicantName').value = userInfo.username;
    document.getElementById('applicantSignature').value = userInfo.username;

    // Handle form submission
    document.getElementById('requestForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const messageDiv = document.getElementById('message');
      
      // Show loading state
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      messageDiv.style.display = 'none';
      
      try {
        // Collect form data
        const formData = new FormData(this);
        const requestData = {
          Department: formData.get('divSecCode') || 'General',
          // Store additional details in a structured way (you might want to add more fields to your Request model)
          Details: {
            applicantName: formData.get('applicantName'),
            divSecCode: formData.get('divSecCode'),
            designation: formData.get('designation'),
            contactPhone: formData.get('contactPhone'),
            email: formData.get('email'),
            systemMake: formData.get('systemMake'),
            configuration: formData.get('configuration'),
            osName: formData.get('osName'),
            licenseDetails: formData.get('licenseDetails'),
            antivirusName: formData.get('antivirusName'),
            macAddress: formData.get('macAddress'),
            itChampion: formData.get('itChampion')
          }
        };

        const response = await fetch(`SubmitRequestHandler.ashx`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestData)
        });

        if (response.ok) {
          const result = await response.json();
          showMessage('Request submitted successfully! Request ID: ' + result.Id, 'success');
          this.reset();
          // Repopulate readonly fields
          document.getElementById('applicantName').value = userInfo.username;
          document.getElementById('applicantSignature').value = userInfo.username;
        } else {
          const error = await response.json();
          throw new Error(error.message || 'Failed to submit request');
        }
      } catch (error) {
        showMessage('Error: ' + error.message, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Request';
      }
    });

    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';
      
      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 5000);
      }
    }

    function logout() {
      sessionStorage.removeItem('userInfo');
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>